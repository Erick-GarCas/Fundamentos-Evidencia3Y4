<!doctype html>
<html lang="es">
{% load static %}
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Crear contacto</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body>
            <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">Agenda</a>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item"><a class="nav-link" href="{% url 'listar' %}">Contactos</a></li>
                        </ul>
                    </div>
                </div>
            </nav>

        <div class="container">
            <h1 class="mb-3">Crear contacto</h1>

            {% if errors %}
            <div class="alert alert-danger">
                <ul class="mb-0">
                {% for field, msg in errors.items %}
                    <li>{{ msg }}</li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}

            <form method="post">
                {% csrf_token %}
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Nombre</label>
                        <input class="form-control" type="text" name="nombre" value="{{ data.nombre|default:'' }}" maxlength="100" pattern="[A-Za-z\s]+">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Primer apellido</label>
                        <input class="form-control" type="text" name="primer_apellido" value="{{ data.primer_apellido|default:'' }}" maxlength="100" pattern="[A-Za-z\s]+">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Segundo apellido</label>
                        <input class="form-control" type="text" name="segundo_apellido" value="{{ data.segundo_apellido|default:'' }}" maxlength="100" pattern="[A-Za-z\s]+">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Alias</label>
                        <input class="form-control" type="text" name="alias" value="{{ data.alias|default:'' }}" maxlength="100" pattern="[A-Za-z\s]+">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Relación</label>
                        <select class="form-select" name="relacion">
                            <option value="">-- seleccione --</option>
                            {% for r in relaciones %}
                                <option value="{{ r.id }}" {% if data.relacion == r.id|stringformat:"s" %}selected{% endif %}>{{ r.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Teléfono</label>
                        <input class="form-control" type="text" name="telefono" value="{{ data.telefono|default:'' }}" maxlength="30" pattern="^\d{10}$">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Correo</label>
                    <input class="form-control" type="email" name="correo" value="{{ data.correo|default:'' }}" pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[A-Za-z]{2,}$">
                </div>

                <button class="btn btn-success" type="submit">Crear</button>
                <a class="btn btn-secondary" href="{% url 'listar' %}">Cancelar</a>
            </form>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

        <!-- arrays proporcionadas por el servidor para validación cliente (usando json_script para evitar errores del editor) -->
    {{ phones|json_script:"phones-data" }}
    {{ emails|json_script:"emails-data" }}
        <script>
            // Leer JSON seguro generado por json_script
            let phones = JSON.parse(document.getElementById('phones-data')?.textContent || '[]');
            let emails = JSON.parse(document.getElementById('emails-data')?.textContent || '[]');
        </script>
        <script src="{% static 'js/confirmar.js' %}"></script>
    </body>
</html>
